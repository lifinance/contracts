---
name: TypeScript scripts
description: TS scripting, helpers, lint/tests
globs:
  - 'script/**/*.ts'
  - 'tasks/**/*.ts'
---

## TypeScript Script Conventions

- TS scripts use `.eslintrc.cjs` rules, `bunx tsx`, `citty`, `consola`, and env validated via helpers (e.g., `getEnvVar()`).
- MUST use viem for all contract interactions in demo/operational scripts; ethers.js helpers are deprecated.
- DO NOT use deprecated ethers-based helpers (`getProvider`, `getWalletFromPrivateKeyInDotEnv`, ethers `sendTransaction`, `ensureBalanceAndAllowanceToDiamond`).

## Code Quality

- Obey `.eslintrc.cjs`; avoid `any`; use TypeChain types from `typechain/` directory (e.g., `ILiFi.BridgeDataStruct`).
- **Always reuse existing helpers and types**: Search `script/common/`, `script/utils/`, `script/demoScripts/utils/`, and other helper directories before implementing new functionality. Key helpers:
  - `script/utils/deploymentHelpers.ts` (deployment loading),
  - `script/demoScripts/utils/demoScriptHelpers.ts` (viem-based demo helpers and swap helpers),
  - `script/common/types.ts` (shared types).
- **Import organization**: Group imports as: external libs (viem, consola, citty, dotenv) → TypeChain types → config files → internal utils/helpers. Use `type` imports for types-only.
- **Error handling**: Use try/catch with `consola.error()` for logging; exit with `process.exit(1)` on fatal errors. Provide meaningful error messages.

## Types

- **Always check for existing types before defining new ones**: Search in order: TypeChain types (`typechain/`), viem types, `script/common/types.ts`, domain-specific type files (e.g., `script/troncast/types.ts`, `script/deploy/tron/types.ts`).
- **Type placement**:
  - Shared/cross-cutting types: `script/common/types.ts` (e.g., `SupportedChain`, `INetwork`, `EnvironmentEnum`).
  - Domain-specific types: colocated in domain-specific files (e.g., Tron types in `script/deploy/tron/types.ts`, Safe types in `script/deploy/safe/safe-utils.ts`).
  - Script-specific types: inline in the script file if only used locally.
- **Reuse existing types**: Prefer importing and reusing existing types over defining duplicates.
- **Naming conventions** (enforced by `.eslintrc.cjs`):
  - **Interfaces MUST start with `I` prefix** (e.g., `INetwork`, `ITransferResult`, `IValidationResults`). This is a hard requirement enforced by ESLint.
  - Type aliases use PascalCase without prefix (e.g., `SupportedChain`, `HexString`).
  - Enums use PascalCase with `Enum` suffix (e.g., `EnvironmentEnum`).

## Demo Scripts

- When referring to "demo script", this means scripts in `script/demoScripts/`. They follow similar structural patterns (e.g., `main()` function, `setupEnvironment()`, helpers from `demoScriptHelpers`). See `demoLidoWrapper.ts`, `demoUnit.ts`, `demoEco.ts` as reference examples.

## CLI and Logging

- CLI: use `citty`; logging via `consola`; validate env via `getEnvVar()`; exit 0/1 appropriately.

## Testing

- New TypeScript helpers must be covered by a colocated `*.test.ts` file using Bun (`describe` / `it` / `expect`) with **100% coverage**. Cover edge cases and error paths.

## Post-Change Actions

- After TS changes run lint/tests (or state which remain) to ensure eslint/type checks pass.
